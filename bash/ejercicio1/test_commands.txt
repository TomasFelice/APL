# =================================================
# LOTE DE PRUEBAS COMPLETO - EJERCICIO 1 BASH
# =================================================
# Cada comando debe ejecutarse desde ./APL/bash/ejercicio1/

# =================================================
# 1. PRUEBAS DE AYUDA
# =================================================

echo "1.1 Ayuda con -h"
bash ./ejercicio1.sh -h

echo -e "\n1.2 Ayuda con --help"
bash ./ejercicio1.sh --help

# =================================================
# 2. PRUEBAS DE PARÁMETROS INCORRECTOS
# =================================================

echo "2.1 Sin parámetros"
bash ./ejercicio1.sh

echo -e "\n2.2 Solo directorio sin salida"
bash ./ejercicio1.sh -d ./in/caso_normal

echo -e "\n2.3 Parámetro desconocido"
bash ./ejercicio1.sh -x parametro_malo

echo -e "\n2.4 Conflicto -a y -p juntos"
bash ./ejercicio1.sh -d ./in/caso_normal -a salida.json -p

# =================================================
# 3. PRUEBAS DE DIRECTORIO INEXISTENTE/INVÁLIDO
# =================================================

echo "3.1 Directorio inexistente"
bash ./ejercicio1.sh -d /directorio/inexistente -p

echo -e "\n3.2 Directorio sin archivos .txt"
bash ./ejercicio1.sh -d ./in/caso_vacio -p

echo -e "\n3.3 Archivo en lugar de directorio"
bash ./ejercicio1.sh -d ./ejercicio1.sh -p

# =================================================
# 4. PRUEBAS DE RUTAS RELATIVAS Y ABSOLUTAS
# =================================================

echo "4.1 Ruta relativa con ./"
bash ./ejercicio1.sh -d ./in/caso_normal -p

echo -e "\n4.2 Ruta relativa sin ./"
bash ./ejercicio1.sh -d bash/ejercicio1/in/caso_normal -p

echo -e "\n4.3 Ruta absoluta"
bash ./ejercicio1.sh -d /home/tfelice/dev/vh/APL/bash/ejercicio1/in/caso_normal -p

# =================================================
# 5. PRUEBAS FUNCIONALES - CASOS NORMALES
# =================================================

echo "5.1 Caso normal - múltiples archivos, salida a pantalla"
bash ./ejercicio1.sh -d ./in/caso_normal -p

echo -e "\n5.2 Caso normal - múltiples archivos, salida a archivo"
bash ./ejercicio1.sh -d ./in/caso_normal -a ./out/caso_normal/resultado_completo.json

echo -e "\n5.3 Verificar archivo generado"
cat ./out/caso_normal/resultado_completo.json

# =================================================
# 6. PRUEBAS CON ARCHIVO ÚNICO
# =================================================

echo "6.1 Archivo único - datos mínimos"
bash ./ejercicio1.sh -d ./in/caso_archivo_unico -p

echo -e "\n6.2 Archivo único - cambio de año"
bash ./ejercicio1.sh --directorio ./in/caso_archivo_unico --archivo ./out/caso_archivo_unico/cambio_año.json

echo -e "\n6.3 Verificar archivo cambio año"
cat ./out/caso_archivo_unico/cambio_año.json

# =================================================
# 7. PRUEBAS CON DATOS INVÁLIDOS
# =================================================

echo "7.1 Archivo con formato incorrecto"
bash ./ejercicio1.sh -d ./in/caso_datos_invalidos -p

# =================================================
# 8. PRUEBAS DE ORDEN DE PARÁMETROS
# =================================================

echo "8.1 Orden: -p -d"
bash ./ejercicio1.sh -p -d ./in/caso_archivo_unico

echo -e "\n8.2 Orden: -a archivo -d directorio"
bash ./ejercicio1.sh -a ./out/casos_especiales/orden_parametros.json -d ./in/caso_archivo_unico

echo -e "\n8.3 Orden con nombres largos"
bash ./ejercicio1.sh --pantalla --directorio ./in/caso_archivo_unico

# =================================================
# 9. PRUEBAS DE ARCHIVOS DE SALIDA CON ERRORES
# =================================================

echo "9.1 Directorio de salida inexistente"
bash ./ejercicio1.sh -d ./in/caso_archivo_unico -a /directorio/inexistente/archivo.json

echo -e "\n9.2 Archivo sin permisos de escritura (simulado)"
touch ./out/casos_especiales/readonly.json
chmod 444 ./out/casos_especiales/readonly.json
bash ./ejercicio1.sh -d ./in/caso_archivo_unico -a ./out/casos_especiales/readonly.json
chmod 644 ./out/casos_especiales/readonly.json

# =================================================
# 10. PRUEBAS DE CASOS EDGE
# =================================================

echo "10.1 Directorio con archivos que no son .txt mezclados"
cp ./in/caso_archivo_unico/datos_minimos.txt ./in/caso_archivo_unico/datos_minimos.bak
bash ./ejercicio1.sh -d ./in/caso_archivo_unico -p
rm ./in/caso_archivo_unico/datos_minimos.bak

echo -e "\n10.2 Procesamiento de datos históricos (múltiples años)"
bash ./ejercicio1.sh -d ./in -a ./out/casos_especiales/datos_historicos.json

echo -e "\n10.3 Verificar datos históricos"
cat ./out/casos_especiales/datos_historicos.json

# =================================================
# 11. PRUEBAS DE LIMPIEZA Y VERIFICACIÓN
# =================================================

echo "11.1 Verificar que no quedan archivos temporales"
ls -la /tmp/ejercicio1.* 2>/dev/null || echo "OK: No hay archivos temporales pendientes"

echo -e "\n11.2 Listar todos los archivos de salida generados"
find ./out -name "*.json" -type f

echo -e "\n=== LOTE DE PRUEBAS COMPLETADO ==="

# =================================================
# COMANDOS DE LIMPIEZA (OPCIONAL)
# =================================================
echo -e "\n=== COMANDOS DE LIMPIEZA (OPCIONAL) ==="
echo "# Para limpiar archivos de salida generados:"
echo "# rm -f ./out/caso_normal/*.json"
echo "# rm -f ./out/caso_archivo_unico/*.json"
echo "# rm -f ./out/casos_especiales/*.json"
